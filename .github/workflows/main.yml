name: VPS

on:
  workflow_dispatch:

jobs:
  create-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: âœ… Start Ubuntu VPS
        run: |
          echo "ğŸš€ Starting Ubuntu VPS..."

      - name: ğŸ”§ Prepare System
        run: |
          sudo apt update -y
          sudo apt install -y openssh-server wget curl unzip
          sudo systemctl enable ssh
          sudo systemctl start ssh
          echo 'root:123456' | sudo chpasswd
          echo "âœ… SSH is ready on port 22"

      - name: ğŸŒ Install Cloudflare Tunnel
        run: |
          wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
          sudo dpkg -i cloudflared-linux-amd64.deb
          echo "âœ… Cloudflare Tunnel Installed"

      - name: ğŸŒ Create Public Tunnel
        run: |
          echo "ğŸ”„ Launching Cloudflare tunnel..."
          nohup cloudflared tunnel --url ssh://localhost:22 > tunnel.log 2>&1 &
          sleep 8
          echo "âœ… Tunnel started successfully!"
          echo "-------------------------------------"
          echo "ğŸ’» VPS LOGIN INFO"
          echo "Username: root"
          echo "Password: 123456"
          echo "-------------------------------------"
          echo "ğŸ“¡ Tunnel URL (use below command to connect):"
          cat tunnel.log | grep -o "https://[-0-9a-z]*\.trycloudflare\.com" | head -n 1
          echo "-------------------------------------"
          echo "ğŸ• VPS active for 60 minutes"
          echo "Keep this workflow running to stay connected!"

      - name: ğŸ’¤ Keep VPS Running
        run: |
          while true; do
            echo "[$(date)] VPS is running..."
            sleep 300
          done
