name: VPS with ngrok TCP

on:
  workflow_dispatch:

jobs:
  create-vps:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: üöÄ Prepare VPS
        run: |
          echo "üöÄ Starting Ubuntu VPS..."
          sudo apt update -y
          sudo apt install -y openssh-server wget curl unzip
          sudo systemctl enable ssh
          sudo systemctl start ssh
          echo 'root:123456' | sudo chpasswd
          echo "‚úÖ SSH is ready on port 22"

      - name: üåê Install ngrok
        run: |
          wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
          unzip ngrok-stable-linux-amd64.zip
          chmod +x ngrok
          sudo mv ngrok /usr/local/bin/
          echo "‚úÖ ngrok installed"

      - name: üîå Start ngrok TCP Tunnel
        run: |
          ./ngrok tcp 22 --region=us > ngrok.log &
          sleep 8
          NGROK_URL=$(grep -o "tcp://[0-9a-z]*\.tcp\.ngrok.io:[0-9]*" ngrok.log | head -n 1)
          echo "‚úÖ Tunnel started!"
          echo "-------------------------------------"
          echo "üíª VPS LOGIN INFO"
          echo "Username: root"
          echo "Password: 123456"
          echo "-------------------------------------"
          echo "üì° Connect via SSH:"
          echo "ssh root@${NGROK_URL#tcp://}"
          echo "-------------------------------------"
          echo "üïê VPS active for 60 minutes"
          sleep 3600
