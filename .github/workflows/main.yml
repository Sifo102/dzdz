name: Telegram Bot + RDP Server
on:
  workflow_dispatch:
jobs:
  telegram-bot-rdp:
    runs-on: windows-latest
    timeout-minutes: 3600
    steps:
      # ========================================
      # Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ø¹Ø¯Ø§Ø¯ RDP Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
      # ========================================
      - name: Configure Core RDP Settings
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
          netsh advfirewall firewall delete rule name="RDP-Tailscale"
          netsh advfirewall firewall add rule name="RDP-Tailscale" dir=in action=allow protocol=TCP localport=3389
          Restart-Service -Name TermService -Force

      - name: Create RDP User with Static Password
        run: |
          $password = "admin@123"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force

          if (-not (Get-LocalUser -Name "TOOLBOXLAP" -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name "TOOLBOXLAP" -Password $securePass -AccountNeverExpires
          }

          Add-LocalGroupMember -Group "Administrators" -Member "TOOLBOXLAP"
          Add-LocalGroupMember -Group "Remote Desktop Users" -Member "TOOLBOXLAP"

          echo "RDP_CREDS=User: TOOLBOXLAP | Password: $password" >> $env:GITHUB_ENV

          if (-not (Get-LocalUser -Name "TOOLBOXLAP")) {
              Write-Error "User creation failed"
              exit 1
          }

      - name: Install Tailscale
        run: |
          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
          $installerPath = "$env:TEMP\tailscale.msi"

          Invoke-WebRequest -Uri $tsUrl -OutFile $installerPath
          Start-Process msiexec.exe -ArgumentList "/i", "`"$installerPath`"", "/quiet", "/norestart" -Wait
          Remove-Item $installerPath -Force

      - name: Establish Tailscale Connection
        run: |
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-runner-$env:GITHUB_RUN_ID
          $tsIP = $null
          $retries = 0
          while (-not $tsIP -and $retries -lt 10) {
              $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
              Start-Sleep -Seconds 5
              $retries++
          }
          if (-not $tsIP) {
              Write-Error "Tailscale IP not assigned. Exiting."
              exit 1
          }
          echo "TAILSCALE_IP=$tsIP" >> $env:GITHUB_ENV

      - name: Verify RDP Accessibility
        run: |
          Write-Host "Tailscale IP: $env:TAILSCALE_IP"
          $testResult = Test-NetConnection -ComputerName $env:TAILSCALE_IP -Port 3389
          if (-not $testResult.TcpTestSucceeded) {
              Write-Error "TCP connection to RDP port 3389 failed"
              exit 1
          }
          Write-Host "TCP connectivity successful!"

      # ========================================
      # Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ø¹Ø¯Ø§Ø¯ Python ÙˆÙ…ÙƒØªØ¨Ø§Øª Telegram
      # ========================================
      - name: Install Python and Required Packages
        run: |
          Write-Host "Installing Python packages for Telegram Bot..."
          
          # ØªØ«Ø¨ÙŠØª Python (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø«Ø¨ØªØ§Ù‹)
          $pythonInstalled = Get-Command python -ErrorAction SilentlyContinue
          if (-not $pythonInstalled) {
              Write-Host "Python not found, installing via winget..."
              winget install --id Python.Python.3.11 -e --accept-package-agreements --accept-source-agreements
          }
          
          # ØªØ­Ø¯ÙŠØ« pip
          python -m pip install --upgrade pip
          
          # ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø§Øª Telegram
          pip install python-telegram-bot==20.3
          pip install requests
          pip install asyncio
          
          Write-Host "Python packages installed successfully!"

      # ========================================
      # Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¨ÙˆØª Telegram
      # ========================================
      - name: Create Telegram Bot Python Script
        run: |
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Python Ù„Ù„Ø¨ÙˆØª - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© Ø³Ø·Ø± Ø¨Ø³Ø·Ø± Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ YAML
          New-Item -Path "telegram_bot.py" -ItemType File -Force
          
          # ÙƒØªØ§Ø¨Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø³Ø·Ø± Ø¨Ø³Ø·Ø±
          Add-Content -Path "telegram_bot.py" -Value "#!/usr/bin/env python3"
          Add-Content -Path "telegram_bot.py" -Value "# -*- coding: utf-8 -*-"
          Add-Content -Path "telegram_bot.py" -Value "import os"
          Add-Content -Path "telegram_bot.py" -Value "import logging"
          Add-Content -Path "telegram_bot.py" -Value "import asyncio"
          Add-Content -Path "telegram_bot.py" -Value "from telegram import Update"
          Add-Content -Path "telegram_bot.py" -Value "from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes"
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "# ==================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª ===================="
          Add-Content -Path "telegram_bot.py" -Value 'TELEGRAM_TOKEN = "7548278006:AAEGJlnZ4hqwAlmJrHnKQ4R6zunDlPkyAyo"'
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "# ==================== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ===================="
          Add-Content -Path "telegram_bot.py" -Value "logging.basicConfig("
          Add-Content -Path "telegram_bot.py" -Value "    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',"
          Add-Content -Path "telegram_bot.py" -Value "    level=logging.INFO,"
          Add-Content -Path "telegram_bot.py" -Value "    handlers=["
          Add-Content -Path "telegram_bot.py" -Value "        logging.FileHandler('telegram_bot.log'),"
          Add-Content -Path "telegram_bot.py" -Value "        logging.StreamHandler()"
          Add-Content -Path "telegram_bot.py" -Value "    ]"
          Add-Content -Path "telegram_bot.py" -Value ")"
          Add-Content -Path "telegram_bot.py" -Value "logger = logging.getLogger(__name__)"
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "# ==================== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===================="
          Add-Content -Path "telegram_bot.py" -Value "async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):"
          Add-Content -Path "telegram_bot.py" -Value '    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©"""'
          Add-Content -Path "telegram_bot.py" -Value "    user = update.effective_user"
          Add-Content -Path "telegram_bot.py" -Value "    user_id = user.id"
          Add-Content -Path "telegram_bot.py" -Value "    user_name = user.first_name or 'Ù…Ø³ØªØ®Ø¯Ù…'"
          Add-Content -Path "telegram_bot.py" -Value "    text = update.message.text"
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    logger.info(f'Ø±Ø³Ø§Ù„Ø© Ù…Ù† {user_name} (ID: {user_id}): {text}')"
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    # Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ (ÙÙˆØ±ÙŠØ©)"
          Add-Content -Path "telegram_bot.py" -Value '    welcome1 = f"""'
          Add-Content -Path "telegram_bot.py" -Value 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—'
          Add-Content -Path "telegram_bot.py" -Value 'â•‘       ğŸŠ **Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ!** ğŸŠ       â•‘'
          Add-Content -Path "telegram_bot.py" -Value 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'âœ¨ **Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ {user_name}** âœ¨'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ†” **Ù…Ø¹Ø±ÙÙƒ:** `{user_id}`'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ‘¤ **Ø§Ø³Ù…Ùƒ:** {user_name}'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ“ **Ø±Ø³Ø§Ù„ØªÙƒ:** {text[:50] if text else "Ø¨Ø¯ÙˆÙ† Ù†Øµ"}'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ† **Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙˆØ§ØµÙ„Ùƒ Ù…Ø¹Ù†Ø§!**'
          Add-Content -Path "telegram_bot.py" -Value '"""'
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    await update.message.reply_text(welcome1, parse_mode='Markdown')"
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    # Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (ÙÙˆØ±ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ±)"
          Add-Content -Path "telegram_bot.py" -Value '    welcome2 = """'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯'
          Add-Content -Path "telegram_bot.py" -Value 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—'
          Add-Content -Path "telegram_bot.py" -Value 'â•‘     ğŸš€ **Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø«Ø§Ù†ÙŠØ©!** ğŸš€      â•‘'
          Add-Content -Path "telegram_bot.py" -Value 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ“Œ **Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¨ÙˆØª:**'
          Add-Content -Path "telegram_bot.py" -Value 'âœ… Ø±Ø¯ ÙÙˆØ±ÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„'
          Add-Content -Path "telegram_bot.py" -Value 'âœ… ØªØ±Ø­ÙŠØ¨ Ù…Ø²Ø¯ÙˆØ¬ Ø¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ±'
          Add-Content -Path "telegram_bot.py" -Value 'âœ… ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø± 24/7'
          Add-Content -Path "telegram_bot.py" -Value 'âœ… Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø®Ø§Ø¯Ù… RDP'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ”§ **Ø§Ù„Ø­Ø§Ù„Ø©:** Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ• **Ø§Ù„ÙˆÙ‚Øª:** Ø§Ù„Ø¢Ù†'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ“Š **Ø§Ù„Ø­Ø§Ù„Ø©:** Ù†Ø´Ø· âœ…'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ’¬ **ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© ÙˆØ³Ø£Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙˆØ±Ø§Ù‹!**'
          Add-Content -Path "telegram_bot.py" -Value '"""'
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    await update.message.reply_text(welcome2, parse_mode='Markdown')"
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):"
          Add-Content -Path "telegram_bot.py" -Value '    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /start"""'
          Add-Content -Path "telegram_bot.py" -Value "    user = update.effective_user"
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value '    start_message = f"""'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸš€ **ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­!**'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ {user.first_name}!'
          Add-Content -Path "telegram_bot.py" -Value '    '
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ“‹ **Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:**'
          Add-Content -Path "telegram_bot.py" -Value '/start - Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª'
          Add-Content -Path "telegram_bot.py" -Value '/help - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©'
          Add-Content -Path "telegram_bot.py" -Value 'Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© - Ø³Ø£Ø±Ø¯ Ø¨ØªØ±Ø­ÙŠØ¨ Ù…Ø²Ø¯ÙˆØ¬!'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'âš¡ **Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø®Ø§Ø¯Ù… GitHub Actions**'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ–¥ï¸ **Ù…Ø¹ Ø®Ø§Ø¯Ù… RDP Ù†Ø´Ø·**'
          Add-Content -Path "telegram_bot.py" -Value '"""'
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    await update.message.reply_text(start_message, parse_mode='Markdown')"
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):"
          Add-Content -Path "telegram_bot.py" -Value '    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ù…Ø± /help"""'
          Add-Content -Path "telegram_bot.py" -Value '    help_text = """'
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ†˜ **Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙˆØª:**'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ“ **ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**'
          Add-Content -Path "telegram_bot.py" -Value '1. Ø£Ø±Ø³Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø©'
          Add-Content -Path "telegram_bot.py" -Value '2. Ø³Ø£Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ø¨Ø±Ø³Ø§Ù„ØªÙŠÙ† ØªØ±Ø­ÙŠØ¨ÙŠØªÙŠÙ†'
          Add-Content -Path "telegram_bot.py" -Value '3. Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø¹Ù‚Ø¯Ø©'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ”§ **Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:**'
          Add-Content -Path "telegram_bot.py" -Value '- Ø±Ø¯ ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ±'
          Add-Content -Path "telegram_bot.py" -Value '- ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø± 24/7'
          Add-Content -Path "telegram_bot.py" -Value '- Ù…ØªÙƒØ§Ù…Ù„ Ù…Ø¹ RDP'
          Add-Content -Path "telegram_bot.py" -Value ''
          Add-Content -Path "telegram_bot.py" -Value 'ğŸ“ **Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±:** Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ³Ø£Ø±Ø¯ ÙÙˆØ±Ø§Ù‹!'
          Add-Content -Path "telegram_bot.py" -Value '"""'
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    await update.message.reply_text(help_text, parse_mode='Markdown')"
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "# ==================== Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===================="
          Add-Content -Path "telegram_bot.py" -Value "def main():"
          Add-Content -Path "telegram_bot.py" -Value '    """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª"""'
          Add-Content -Path "telegram_bot.py" -Value "    logger.info('Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¨ÙˆØª Telegram...')"
          Add-Content -Path "telegram_bot.py" -Value "    "
          Add-Content -Path "telegram_bot.py" -Value "    try:"
          Add-Content -Path "telegram_bot.py" -Value "        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
          Add-Content -Path "telegram_bot.py" -Value "        application = Application.builder().token(TELEGRAM_TOKEN).build()"
          Add-Content -Path "telegram_bot.py" -Value "        "
          Add-Content -Path "telegram_bot.py" -Value "        # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª"
          Add-Content -Path "telegram_bot.py" -Value "        application.add_handler(CommandHandler('start', start_command))"
          Add-Content -Path "telegram_bot.py" -Value "        application.add_handler(CommandHandler('help', help_command))"
          Add-Content -Path "telegram_bot.py" -Value "        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))"
          Add-Content -Path "telegram_bot.py" -Value "        "
          Add-Content -Path "telegram_bot.py" -Value "        logger.info('Ø§Ù„Ø¨ÙˆØª Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„...')"
          Add-Content -Path "telegram_bot.py" -Value "        "
          Add-Content -Path "telegram_bot.py" -Value "        # Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„"
          Add-Content -Path "telegram_bot.py" -Value "        application.run_polling(allowed_updates=Update.ALL_TYPES)"
          Add-Content -Path "telegram_bot.py" -Value "        "
          Add-Content -Path "telegram_bot.py" -Value "    except Exception as e:"
          Add-Content -Path "telegram_bot.py" -Value "        logger.error(f'Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª: {e}')"
          Add-Content -Path "telegram_bot.py" -Value "        raise"
          Add-Content -Path "telegram_bot.py" -Value ""
          Add-Content -Path "telegram_bot.py" -Value "# ==================== Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ===================="
          Add-Content -Path "telegram_bot.py" -Value 'if __name__ == "__main__":'
          Add-Content -Path "telegram_bot.py" -Value "    main()"
          
          Write-Host "âœ… Telegram bot script created successfully!"

      # ========================================
      # Ø§Ù„Ø®Ø·ÙˆØ© 4: ØªØ´ØºÙŠÙ„ Ø¨ÙˆØª Telegram ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
      # ========================================
      - name: Start Telegram Bot in Background
        run: |
          Write-Host "Starting Telegram Bot..."
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
          Start-Process python -ArgumentList "telegram_bot.py" -WindowStyle Hidden
          
          # Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
          Start-Sleep -Seconds 10
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
          $botProcess = Get-Process python -ErrorAction SilentlyContinue | Where-Object {$_.MainWindowTitle -like "*telegram*" -or $_.ProcessName -eq "python"}
          if ($botProcess) {
              Write-Host "âœ… Telegram Bot is running! (PID: $($botProcess.Id))"
          } else {
              Write-Host "âš ï¸ Bot process not found, trying to run directly..."
              # ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ØªØ­Ù‚Ù‚
              python telegram_bot.py &
          }

      # ========================================
      # Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ´ØºÙŠÙ„
      # ========================================
      - name: Maintain Both Services Running
        run: |
          Write-Host ""
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          Write-Host "â•‘      âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ…                  â•‘"
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          Write-Host ""
          
          Write-Host "=================== RDP ACCESS ==================="
          Write-Host "Address: $env:TAILSCALE_IP"
          Write-Host "Username: TOOLBOXLAP"
          Write-Host "Password: admin@123"
          Write-Host ""
          
          Write-Host "================ TELEGRAM BOT ===================="
          Write-Host "Bot Token: 7548278006:AAEGJlnZ4hqwAlmJrHnKQ4R6zunDlPkyAyo"
          Write-Host "Status: Running in background"
          Write-Host "Features: Instant reply with double welcome messages"
          Write-Host ""
          
          Write-Host "============== SYSTEM INFORMATION ==============="
          Write-Host "Host: GitHub Actions Windows Runner"
          Write-Host "Services: RDP Server + Telegram Bot"
          Write-Host "Uptime: Will run for 60 hours (3600 minutes)"
          Write-Host ""
          
          Write-Host "ğŸ“Œ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ RDP: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ø¹Ù„Ø§Ù‡"
          Write-Host "ğŸ¤– Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØª: Ø£Ø±Ø³Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª"
          Write-Host ""
          
          # Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªØ´ØºÙŠÙ„
          $minutes = 0
          while ($true) {
              $minutes++
              $currentTime = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
              
              if ($minutes % 30 -eq 0) {
                  Write-Host ""
                  Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                  Write-Host "[$currentTime] Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ - $minutes Ø¯Ù‚ÙŠÙ‚Ø©"
                  Write-Host "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                  
                  # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
                  $botProcess = Get-Process python -ErrorAction SilentlyContinue | Select-Object -First 1
                  if ($botProcess) {
                      Write-Host "Telegram Bot: âœ… Ù†Ø´Ø· (PID: $($botProcess.Id))"
                  } else {
                      Write-Host "Telegram Bot: âŒ Ù…ØªÙˆÙ‚ÙØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„..."
                      Start-Process python -ArgumentList "telegram_bot.py" -WindowStyle Hidden
                  }
                  
                  # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© RDP
                  $rdpService = Get-Service TermService
                  Write-Host "RDP Service: $($rdpService.Status)"
              }
              
              Write-Host "[$currentTime] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªØ¹Ù…Ù„ - Ø§Ø¶ØºØ· Ctrl+C ÙÙŠ GitHub Ù„Ø¥ÙŠÙ‚Ø§Ù"
              Start-Sleep -Seconds 60
          }
